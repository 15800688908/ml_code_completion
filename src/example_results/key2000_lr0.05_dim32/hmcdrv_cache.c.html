<!DOCTYPE html>
<html>
<head>
<style>
span.c {
    background-color: #CCFFCC;
}
span.pc {
    background-color: #FFEEBB;
}
span.w {
    background-color: #FFCCCC;
}
</style>
</head>
<body>
<pre>


<span class="w">#define</span> <span class="w">KMSG_COMPONENT</span> <span class="w">"hmcdrv"</span>
<span class="w">#define</span> <span class="w">pr_fmt(fmt)</span> <span class="w">KMSG_COMPONENT</span> <span class="w">": "</span> <span class="w">fmt</span>

<span class="w">#include</span> <span class="w">&lt;linux/kernel.h&gt;</span>
<span class="w">#include</span> <span class="w">&lt;linux/mm.h&gt;</span>
<span class="w">#include</span> <span class="w">&lt;linux/jiffies.</span><span class="c">h&gt;</span>

<span class="c">#include</span> <span class="pc">"</span><span class="w">hmcdrv_ftp</span><span class="c">.h"</span>
<span class="c">#include</span> <span class="c">"</span><span class="w">hmcdrv_cache</span><span class="c">.h"</span>

<span class="c">#</span><span class="pc">d</span><span class="c">efine</span> <span class="w">HMCDRV_CACHE_TIMEOUT</span>		<span class="w">3</span><span class="c">0</span> 


<span class="w">s</span><span class="pc">tr</span><span class="c">uct</span> <span class="w">hmcdrv_cache_entry</span> <span class="c">{</span>
	<span class="w">e</span><span class="c">num</span> <span class="w">hmcdrv_ftp_cmdid</span> <span class="w">i</span><span class="c">d;</span>
	<span class="w">c</span><span class="pc">h</span><span class="c">ar</span> <span class="w">fname</span><span class="c">[</span><span class="w">HMCDRV_FTP_FIDENT_MAX</span><span class="c">];</span>
	<span class="w">s</span><span class="pc">i</span><span class="c">ze_t</span> <span class="w">fsize</span><span class="c">;</span>
	<span class="w">l</span><span class="pc">of</span><span class="c">f_t</span> <span class="w">of</span><span class="pc">s</span><span class="c">;</span>
	<span class="pc">u</span><span class="c">nsigned</span> <span class="pc">l</span><span class="c">ong</span> <span class="w">t</span><span class="pc">imeo</span><span class="c">ut;</span>
	<span class="w">v</span><span class="c">oid</span> <span class="pc">*</span><span class="w">content</span><span class="c">;</span>
	<span class="w">s</span><span class="pc">i</span><span class="c">ze_t</span> <span class="pc">l</span><span class="c">en;</span>
<span class="c">};</span>

<span class="pc">sta</span><span class="c">tic</span> <span class="pc">int</span> <span class="w">hmcdrv_cache_order</span><span class="pc">;</span> 

<span class="w">s</span><span class="pc">ta</span><span class="c">tic</span> <span class="pc">s</span><span class="c">truct</span> <span class="c">hmcdrv_cache_entry</span> <span class="w">hmcdrv_cache_file</span> <span class="w">=</span><span class="c"> {</span>
	<span class="c">.</span><span class="w">f</span><span class="c">size</span> <span class="pc">=</span> <span class="w">SIZE_MAX</span><span class="c">,</span>
	<span class="c">.</span><span class="w">ofs</span> <span class="w">= -</span><span class="c">1,</span>
	<span class="c">.</span><span class="w">l</span><span class="c">en</span> <span class="c">=</span> <span class="pc">0</span><span class="c">,</span>
	<span class="c">.</span><span class="w">fname</span> <span class="w">= {'\0'}</span>
<span class="c">};</span>


<span class="c">static</span> <span class="w">s</span><span class="pc">s</span><span class="c">ize_t</span> <span class="w">hmcdrv_cache_get</span><span class="c">(</span><span class="pc">c</span><span class="c">onst</span> <span class="c">struct</span> <span class="w">hmcdrv_ftp_cmdspec</span> <span class="c">*</span><span class="w">ftp</span><span class="pc">)</span>
<span class="c">{</span>
	<span class="w">l</span><span class="pc">of</span><span class="c">f_t</span> <span class="w">p</span><span class="pc">o</span><span class="c">s;</span> 
	<span class="w">ss</span><span class="c">ize_t</span> <span class="pc">l</span><span class="c">en;</span>

	<span class="w">i</span><span class="pc">f</span> <span class="pc">((f</span><span class="c">tp</span><span class="pc">-</span><span class="c">&gt;</span><span class="pc">i</span><span class="c">d</span> <span class="pc">!</span><span class="c">=</span> <span class="w">hmcdrv_cache_file.i</span><span class="c">d</span><span class="w">) |</span><span class="pc">|</span>
	    <span class="w">str</span><span class="pc">c</span><span class="c">mp(</span><span class="pc">h</span><span class="c">mcdrv_cache_file</span><span class="w">.f</span><span class="pc">n</span><span class="c">ame</span><span class="w">,</span> <span class="c">ftp</span><span class="pc">-</span><span class="c">&gt;</span><span class="w">f</span><span class="pc">n</span><span class="c">ame</span><span class="w">)</span><span class="pc">)</span>
		<span class="c">return</span> <span class="pc">-1</span><span class="c">;</span>

	<span class="pc">i</span><span class="c">f</span> <span class="c">(ftp-&gt;</span><span class="w">ofs</span> <span class="w">&gt;</span><span class="pc">=</span> <span class="w">h</span><span class="c">mcdrv_cache_file</span><span class="w">.fsize</span><span class="pc">)</span> 
		<span class="c">return</span> <span class="pc">0</span><span class="c">;</span>

	<span class="pc">i</span><span class="c">f</span> <span class="pc">((h</span><span class="c">mcdrv_cache_file</span><span class="pc">.</span><span class="w">of</span><span class="pc">s</span> <span class="w">&lt;</span> <span class="c">0</span><span class="w">) |</span><span class="pc">|</span> 
	    <span class="w">time_after</span><span class="c">(</span><span class="w">j</span><span class="c">iffies</span><span class="w">,</span> <span class="c">hmcdrv_cache_file</span><span class="pc">.</span><span class="w">t</span><span class="pc">i</span><span class="c">meout</span><span class="w">)</span><span class="pc">)</span>
		<span class="c">return</span> <span class="c">-</span><span class="pc">1</span><span class="c">;</span>

	
	<span class="w">l</span><span class="pc">en</span> <span class="c">=</span> <span class="pc">h</span><span class="c">mcdrv_cache_file</span><span class="pc">.fs</span><span class="c">ize</span> <span class="w">-</span> <span class="pc">f</span><span class="c">tp</span><span class="pc">-</span><span class="c">&gt;</span><span class="w">of</span><span class="pc">s;</span>

	<span class="c">if</span> <span class="c">(</span><span class="pc">l</span><span class="c">en</span> <span class="pc">&gt;</span> <span class="w">f</span><span class="pc">t</span><span class="c">p</span><span class="pc">-</span><span class="c">&gt;</span><span class="pc">l</span><span class="c">en)</span>
		<span class="pc">l</span><span class="c">en</span> <span class="pc">=</span> <span class="pc">f</span><span class="c">tp</span><span class="pc">-</span><span class="c">&gt;</span><span class="w">l</span><span class="c">en;</span>

	
	<span class="w">p</span><span class="pc">o</span><span class="c">s</span> <span class="pc">=</span> <span class="pc">f</span><span class="c">tp</span><span class="pc">-</span><span class="c">&gt;</span><span class="w">ofs</span> <span class="w">-</span> <span class="pc">h</span><span class="c">mcdrv_cache_file</span><span class="pc">.</span><span class="w">ofs</span><span class="pc">;</span>

	<span class="pc">i</span><span class="c">f</span> <span class="pc">((</span><span class="w">p</span><span class="pc">o</span><span class="c">s</span> <span class="pc">&gt;=</span> <span class="pc">0</span><span class="w">) </span><span class="pc">&amp;&amp;</span>
	    <span class="pc">((</span><span class="w">p</span><span class="pc">o</span><span class="c">s</span> <span class="c">+</span> <span class="pc">l</span><span class="c">en</span><span class="w">) &lt;=</span> <span class="w">h</span><span class="c">mcdrv_cache_file</span><span class="w">.</span><span class="pc">l</span><span class="c">en</span><span class="w">)</span><span class="pc">) </span><span class="c">{</span>

		<span class="w">m</span><span class="c">emcpy(</span><span class="pc">f</span><span class="c">tp-&gt;</span><span class="w">b</span><span class="c">uf</span><span class="pc">,</span>
		       <span class="pc">h</span><span class="c">mcdrv_cache_file</span><span class="w">.content</span> <span class="pc">+</span> <span class="w">p</span><span class="c">os</span><span class="pc">,</span>
		       <span class="c">len);</span>
		<span class="w">p</span><span class="pc">r_</span><span class="c">debug("</span><span class="w">using</span> <span class="w">cached</span> <span class="w">co</span><span class="pc">nte</span><span class="c">nt</span> <span class="w">o</span><span class="c">f</span> <span class="w">'%s'</span><span class="pc">,</span> <span class="w">returning</span> <span class="w">%zd/</span><span class="c">%</span><span class="pc">z</span><span class="c">d</span> <span class="pc">b</span><span class="c">ytes</span><span class="w">\</span><span class="c">n",</span>
			 <span class="pc">h</span><span class="c">mcdrv_cache_file</span><span class="w">.fname</span><span class="c">,</span> <span class="w">l</span><span class="pc">en</span><span class="c">,</span>
			 <span class="w">h</span><span class="c">mcdrv_cache_file</span><span class="pc">.</span><span class="w">fsize</span><span class="pc">)</span><span class="c">;</span>

		<span class="w">r</span><span class="c">eturn</span> <span class="w">l</span><span class="c">en;</span>
	<span class="c">}</span>

	<span class="w">r</span><span class="c">eturn</span> <span class="pc">-</span><span class="w">1</span><span class="c">;</span>
<span class="c">}</span>


<span class="c">static</span> <span class="pc">ss</span><span class="c">ize_t</span> <span class="w">hmcdrv_cache_do</span><span class="c">(</span><span class="pc">c</span><span class="c">onst</span> <span class="c">struct</span> <span class="w">hmcdrv_ftp_cmdspec</span> <span class="c">*</span><span class="w">ftp</span><span class="c">,</span>
			       <span class="w">hmcdrv_cache_ftpfunc</span> <span class="w">fu</span><span class="c">nc</span><span class="pc">)</span>
<span class="c">{</span>
	<span class="w">ss</span><span class="c">ize_t</span> <span class="w">l</span><span class="c">en</span><span class="pc">;</span>

	
	<span class="pc">i</span><span class="c">f</span> <span class="pc">((</span><span class="c">ftp</span><span class="pc">-</span><span class="c">&gt;</span><span class="w">l</span><span class="c">en</span> <span class="w">&gt;</span> <span class="pc">0</span><span class="w">)</span><span class="pc"> &amp;&amp; </span><span class="c">(</span><span class="pc">hmcdrv_c</span><span class="c">ache_file</span><span class="w">.</span><span class="pc">l</span><span class="c">en</span> <span class="w">&gt;</span><span class="pc">=</span> <span class="pc">f</span><span class="c">tp</span><span class="pc">-</span><span class="c">&gt;</span><span class="w">l</span><span class="c">en</span><span class="w">)</span><span class="pc">) </span><span class="c">{</span>

		
		<span class="w">st</span><span class="pc">r</span><span class="c">uct</span> <span class="pc">h</span><span class="c">mcdrv_ftp_cmdspec</span> <span class="w">cftp</span> <span class="w">=</span><span class="pc"> *f</span><span class="c">tp;</span> 
		<span class="w">c</span><span class="c">ftp</span><span class="w">.b</span><span class="c">uf</span> <span class="c">=</span> <span class="w">h</span><span class="pc">mcdrv_c</span><span class="c">ache_file</span><span class="w">.content</span><span class="c">;</span>  
		<span class="pc">c</span><span class="c">ftp</span><span class="pc">.</span><span class="w">l</span><span class="c">en</span> <span class="c">=</span> <span class="pc">h</span><span class="c">mcdrv_cache_file</span><span class="pc">.l</span><span class="c">en;</span>      

		<span class="w">l</span><span class="pc">en</span> <span class="c">=</span> <span class="w">fu</span><span class="pc">nc</span><span class="w">(</span><span class="pc">&amp;c</span><span class="c">ftp</span><span class="w">,</span><span class="pc"> </span><span class="c">&amp;hmcdrv_cache_file</span><span class="pc">.</span><span class="w">fsize</span><span class="c">);</span> 

		<span class="c">if</span> <span class="c">(</span><span class="w">l</span><span class="c">en</span> <span class="pc">&gt;</span> <span class="c">0) {</span>
			<span class="w">p</span><span class="pc">r_d</span><span class="c">ebug("</span><span class="w">caching</span> <span class="pc">%</span><span class="w">zd</span> <span class="w">b</span><span class="pc">yt</span><span class="c">es</span> <span class="w">co</span><span class="pc">nte</span><span class="c">nt</span> <span class="w">f</span><span class="pc">o</span><span class="c">r</span> <span class="w">'%s'\</span><span class="c">n",</span>
				 <span class="w">l</span><span class="c">en</span><span class="pc">,</span> <span class="w">ftp-</span><span class="c">&gt;</span><span class="w">fname</span><span class="pc">)</span><span class="c">;</span>

			<span class="c">if</span> <span class="c">(</span><span class="w">l</span><span class="c">en</span> <span class="w">&gt;</span> <span class="w">f</span><span class="pc">t</span><span class="c">p</span><span class="pc">-</span><span class="c">&gt;</span><span class="w">l</span><span class="c">en)</span>
				<span class="w">l</span><span class="c">en</span> <span class="pc">=</span> <span class="c">ftp-&gt;</span><span class="w">l</span><span class="c">en;</span>

			<span class="w">hmcdrv_cache_file.ofs</span> <span class="c">=</span> <span class="c">ftp-&gt;</span><span class="w">of</span><span class="pc">s</span><span class="c">;</span>
			<span class="pc">h</span><span class="c">mcdrv_cache_file</span><span class="pc">.</span><span class="w">ti</span><span class="pc">meo</span><span class="c">ut</span> <span class="c">=</span> <span class="w">j</span><span class="c">iffies</span> <span class="c">+</span>
				<span class="w">HMCDRV_CACHE_TIMEOUT</span> <span class="w">*</span> <span class="w">H</span><span class="c">Z;</span>
			<span class="w">m</span><span class="pc">e</span><span class="c">mcpy(ftp-&gt;</span><span class="pc">b</span><span class="c">uf,</span> <span class="pc">h</span><span class="c">mcdrv_cache_file</span><span class="pc">.</span><span class="w">content</span><span class="pc">,</span> <span class="w">l</span><span class="c">en</span><span class="pc">)</span><span class="c">;</span>
		<span class="pc">}</span>
	<span class="w">}</span> <span class="pc">e</span><span class="c">lse</span> <span class="c">{</span>
		<span class="w">l</span><span class="pc">e</span><span class="c">n</span> <span class="c">=</span> <span class="w">fu</span><span class="c">nc</span><span class="pc">(f</span><span class="c">tp</span><span class="pc">, </span><span class="c">&amp;hmcdrv_cache_file</span><span class="pc">.</span><span class="w">fsize</span><span class="c">);</span>
		<span class="w">h</span><span class="c">mcdrv_cache_file</span><span class="pc">.</span><span class="w">of</span><span class="pc">s</span> <span class="w">=</span><span class="pc"> -</span><span class="c">1;</span> 
	<span class="c">}</span>

	<span class="w">i</span><span class="c">f</span> <span class="c">(</span><span class="w">l</span><span class="c">en</span> <span class="pc">&gt;</span> <span class="c">0</span><span class="pc">) </span><span class="c">{</span>
		
		<span class="w">str</span><span class="pc">lc</span><span class="c">py(</span><span class="pc">h</span><span class="c">mcdrv_cache_file</span><span class="pc">.</span><span class="w">fname</span><span class="c">,</span> <span class="pc">f</span><span class="c">tp</span><span class="pc">-</span><span class="c">&gt;fname</span><span class="pc">,</span>
			<span class="w">HMCDRV_FTP_FIDENT_MAX</span><span class="pc">)</span><span class="c">;</span>
		<span class="w">h</span><span class="c">mcdrv_cache_file</span><span class="pc">.</span><span class="w">i</span><span class="pc">d</span> <span class="c">=</span> <span class="pc">ft</span><span class="c">p-&gt;</span><span class="w">i</span><span class="pc">d;</span>
		<span class="w">p</span><span class="c">r_debug("</span><span class="w">caching</span> <span class="w">cm</span><span class="c">d</span> <span class="pc">%d</span><span class="w">,</span> <span class="w">fil</span><span class="pc">e</span> <span class="w">s</span><span class="pc">i</span><span class="c">ze</span> <span class="pc">%</span><span class="w">zu</span> <span class="w">f</span><span class="pc">o</span><span class="c">r</span> <span class="w">'%s'\</span><span class="pc">n</span><span class="c">",</span>
			 <span class="pc">f</span><span class="c">tp-&gt;</span><span class="w">i</span><span class="c">d,</span> <span class="pc">h</span><span class="c">mcdrv_cache_file</span><span class="w">.fsize</span><span class="c">,</span> <span class="c">ftp</span><span class="pc">-</span><span class="c">&gt;</span><span class="pc">fn</span><span class="c">ame</span><span class="pc">)</span><span class="c">;</span>
	<span class="c">}</span>

	<span class="w">r</span><span class="c">eturn</span> <span class="w">le</span><span class="pc">n</span><span class="c">;</span>
<span class="c">}</span>


<span class="w">ss</span><span class="c">ize_t</span> <span class="w">hmcdrv_cache_cmd</span><span class="c">(</span><span class="w">c</span><span class="pc">ons</span><span class="c">t</span> <span class="c">struct</span> <span class="w">hmcdrv_ftp_cmdspec</span> <span class="c">*</span><span class="w">f</span><span class="pc">t</span><span class="c">p,</span>
			 <span class="w">hmcdrv_cache_ftpfunc</span> <span class="w">fu</span><span class="c">nc</span><span class="pc">)</span>
<span class="c">{</span>
	<span class="w">ss</span><span class="c">ize_t</span> <span class="w">l</span><span class="pc">e</span><span class="c">n;</span>

	<span class="pc">i</span><span class="c">f</span> <span class="pc">((</span><span class="c">ftp-&gt;</span><span class="pc">i</span><span class="c">d</span> <span class="c">==</span> <span class="w">HMCDRV_FTP_DIR) </span><span class="pc">|</span><span class="c">|</span> 
	    <span class="c">(</span><span class="w">f</span><span class="pc">t</span><span class="c">p-&gt;</span><span class="w">i</span><span class="c">d</span> <span class="c">==</span> <span class="w">HMCDRV_FTP_NLIST</span><span class="c">) ||</span>
	    <span class="pc">(</span><span class="c">ftp-&gt;</span><span class="pc">i</span><span class="c">d</span> <span class="c">==</span> <span class="w">HMCDRV_FTP_GET</span><span class="pc">)) </span><span class="c">{</span>

		<span class="w">l</span><span class="c">en</span> <span class="c">=</span> <span class="w">hmcdrv_cache_get</span><span class="c">(ftp</span><span class="pc">)</span><span class="c">;</span>

		<span class="c">if</span> <span class="c">(</span><span class="w">l</span><span class="c">en</span> <span class="w">&gt;</span><span class="pc">=</span> <span class="c">0)</span> 
			<span class="c">return</span> <span class="w">l</span><span class="c">en;</span> 

		<span class="w">l</span><span class="c">en</span> <span class="c">=</span> <span class="w">hmcdrv_cache_do</span><span class="c">(ftp,</span> <span class="w">fu</span><span class="c">nc</span><span class="pc">)</span><span class="c">;</span>

		<span class="c">if</span> <span class="c">(</span><span class="w">l</span><span class="c">en</span> <span class="w">&gt;</span><span class="pc">=</span> <span class="c">0)</span>
			<span class="c">return</span> <span class="w">l</span><span class="c">en;</span>

	<span class="pc">}</span> <span class="pc">e</span><span class="c">lse</span> <span class="pc">{</span>
		<span class="w">l</span><span class="c">en</span> <span class="c">=</span> <span class="w">f</span><span class="pc">u</span><span class="c">nc</span><span class="pc">(</span><span class="c">ftp,</span> <span class="w">N</span><span class="c">ULL);</span> 
	<span class="pc">}</span>

	
	<span class="w">hmcdrv_cache_file.i</span><span class="c">d</span> <span class="c">=</span> <span class="w">HMCDRV_FTP_NOOP</span><span class="c">;</span>
	<span class="pc">h</span><span class="c">mcdrv_cache_file</span><span class="pc">.</span><span class="w">fsize</span> <span class="c">=</span> <span class="w">LLONG_MAX</span><span class="c">;</span>
	<span class="c">hmcdrv_cache_file.</span><span class="w">of</span><span class="pc">s</span> <span class="w">= -</span><span class="c">1;</span>

	<span class="w">r</span><span class="c">eturn</span> <span class="w">l</span><span class="c">en;</span>
<span class="c">}</span>


<span class="pc">i</span><span class="c">nt</span> <span class="w">hmcdrv_cache_startup</span><span class="c">(</span><span class="w">s</span><span class="pc">ize_</span><span class="c">t</span> <span class="w">cachesize</span><span class="pc">)</span>
<span class="c">{</span>
	<span class="pc">if</span> <span class="c">(</span><span class="pc">c</span><span class="c">achesize</span> <span class="w">&gt;</span> <span class="c">0</span><span class="pc">) </span><span class="c">{</span> 
		<span class="w">hmcdrv_cache_order</span> <span class="c">=</span> <span class="w">get_order</span><span class="c">(</span><span class="pc">c</span><span class="c">achesize</span><span class="pc">)</span><span class="c">;</span>
		<span class="pc">hmcdrv_cache_f</span><span class="c">ile</span><span class="pc">.</span><span class="w">content</span> <span class="c">=</span>
			<span class="w">(v</span><span class="pc">o</span><span class="c">id</span> <span class="w">*</span><span class="pc">)</span> <span class="w">__get_free_pages</span><span class="c">(</span><span class="w">G</span><span class="c">FP_KERNEL</span> <span class="w">|</span> <span class="w">GFP_DMA</span><span class="pc">,</span>
						  <span class="c">hmcdrv_cache_order);</span>

		<span class="c">if</span> <span class="pc">(!hmcdrv_cache_f</span><span class="c">ile</span><span class="w">.</span><span class="pc">co</span><span class="c">ntent) {</span>
			<span class="w">p</span><span class="pc">r_</span><span class="c">err("</span><span class="w">Allocating</span> <span class="w">t</span><span class="pc">h</span><span class="c">e</span> <span class="w">requested</span> <span class="w">cac</span><span class="pc">he</span> <span class="w">si</span><span class="c">ze</span> <span class="w">o</span><span class="c">f</span> <span class="w">%zu</span> <span class="w">b</span><span class="c">ytes</span> <span class="w">f</span><span class="pc">a</span><span class="c">iled\n",</span>
			       <span class="w">c</span><span class="pc">a</span><span class="c">chesize);</span>
			<span class="c">return</span> <span class="c">-</span><span class="w">EN</span><span class="pc">OM</span><span class="c">EM;</span>
		<span class="c">}</span>

		<span class="w">p</span><span class="pc">r_d</span><span class="c">ebug("content</span> <span class="w">cac</span><span class="pc">he</span> <span class="w">en</span><span class="pc">abled</span><span class="w">,</span> <span class="w">s</span><span class="pc">ize</span> <span class="w">is</span> <span class="pc">%</span><span class="w">z</span><span class="c">u</span> <span class="w">b</span><span class="c">ytes</span><span class="pc">\</span><span class="c">n",</span>
			 <span class="pc">ca</span><span class="c">chesize</span><span class="pc">)</span><span class="c">;</span>
	<span class="pc">}</span>

	<span class="w">hmcdrv_cache_file.l</span><span class="pc">e</span><span class="c">n</span> <span class="c">=</span> <span class="c">cachesize;</span>
	<span class="pc">r</span><span class="c">eturn</span> <span class="c">0;</span>
<span class="c">}</span>


<span class="pc">v</span><span class="c">oid</span> <span class="w">hmcdrv_cache_shutdown</span><span class="c">(</span><span class="pc">v</span><span class="c">oid</span><span class="pc">)</span>
<span class="c">{</span>
	<span class="w">i</span><span class="pc">f</span> <span class="c">(</span><span class="pc">h</span><span class="c">mcdrv_cache_file</span><span class="w">.c</span><span class="pc">o</span><span class="c">ntent</span><span class="pc">)</span><span class="c"> {</span>
		<span class="w">free_pages(</span><span class="pc">(u</span><span class="c">nsigned</span> <span class="c">long</span><span class="w">)</span> <span class="pc">h</span><span class="c">mcdrv_cache_file</span><span class="pc">.</span><span class="w">c</span><span class="pc">o</span><span class="c">ntent</span><span class="pc">,</span>
			   <span class="w">hmcdrv_cache_order</span><span class="pc">)</span><span class="c">;</span>
		<span class="pc">h</span><span class="c">mcdrv_cache_file</span><span class="pc">.</span><span class="w">c</span><span class="pc">o</span><span class="c">ntent</span> <span class="c">=</span> <span class="w">N</span><span class="c">ULL;</span>
	<span class="c">}</span>

	<span class="w">h</span><span class="pc">mcdrv_cache_f</span><span class="c">ile</span><span class="pc">.</span><span class="w">i</span><span class="c">d</span> <span class="c">=</span> <span class="w">HMCDRV_FTP_NOOP</span><span class="c">;</span>
	<span class="pc">h</span><span class="c">mcdrv_cache_file.</span><span class="w">fsize</span> <span class="c">=</span> <span class="w">LLONG_MAX</span><span class="c">;</span>
	<span class="w">h</span><span class="c">mcdrv_cache_file.</span><span class="w">ofs</span> <span class="w">=</span><span class="pc"> -</span><span class="c">1;</span>
	<span class="pc">h</span><span class="c">mcdrv_cache_file.</span><span class="w">l</span><span class="c">en</span> <span class="c">=</span> <span class="c">0;</span> 
<span class="pc">}</span>

</pre>
</body>
</html>

