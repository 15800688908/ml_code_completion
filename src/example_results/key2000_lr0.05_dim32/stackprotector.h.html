<!DOCTYPE html>
<html>
<head>
<style>
span.c {
    background-color: #CCFFCC;
}
span.pc {
    background-color: #FFEEBB;
}
span.w {
    background-color: #FFCCCC;
}
</style>
</head>
<body>
<pre>


<span class="w">#ifndef</span> <span class="w">__ASM_STACKPROTECTOR_H</span>
<span class="w">#define</span> <span class="w">__ASM_STACKPROTECTOR_H</span>

<span class="w">#include</span> <span class="w">&lt;linux/random.h&gt;</span>
<span class="w">#include</span> <span class="w">&lt;linux/version.h&gt;</span>

<span class="w">extern</span> <span class="w">unsigned</span> <span class="w">long</span> <span class="w">__stack_chk_guard;</span>


<span class="w">static</span> <span class="w">__always_inline</span> <span class="w">void</span> <span class="w">boot_init_stack_canary(void)</span>
<span class="w">{</span>
	<span class="w">unsigned</span> <span class="w">long</span> <span class="w">canary</span><span class="c">;</span>

	
	<span class="w">get_random_bytes</span><span class="pc">(&amp;</span><span class="w">c</span><span class="c">anary</span><span class="pc">,</span> <span class="w">s</span><span class="pc">i</span><span class="c">zeof(</span><span class="pc">c</span><span class="c">anary));</span>
	<span class="pc">c</span><span class="c">anary</span> <span class="w">^=</span> <span class="w">LINUX_VERSION_CODE</span><span class="pc">;</span>

	<span class="w">cu</span><span class="c">rrent-&gt;</span><span class="w">stack_canary</span> <span class="c">=</span> <span class="c">canary;</span>
	<span class="w">_</span><span class="pc">_s</span><span class="c">tack_chk_guard</span> <span class="pc">=</span> <span class="w">cu</span><span class="pc">rre</span><span class="c">nt-&gt;stack_canary;</span>
<span class="c">}</span>

<span class="c">#endif</span>	

</pre>
</body>
</html>

