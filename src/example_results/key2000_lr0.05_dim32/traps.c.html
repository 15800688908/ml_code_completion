<!DOCTYPE html>
<html>
<head>
<style>
span.c {
    background-color: #CCFFCC;
}
span.pc {
    background-color: #FFEEBB;
}
span.w {
    background-color: #FFCCCC;
}
</style>
</head>
<body>
<pre>

<span class="w">#include</span> <span class="w">&lt;linux/module.h&gt;</span>
<span class="w">#include</span> <span class="w">&lt;linux/ptrace.h&gt;</span>
<span class="w">#include</span> <span class="w">&lt;linux/kallsyms.h&gt;</span>
<span class="w">#include</span> <span class="w">&lt;linux/bug.h&gt;</span>

<span class="w">#include</span> <span class="w">&lt;asm</span><span class="c">/</span><span class="w">so</span><span class="pc">c</span><span class="c">.h&gt;</span>
<span class="c">#include</span> <span class="c">&lt;asm/</span><span class="w">special_insns</span><span class="c">.h&gt;</span>
<span class="c">#include</span> <span class="c">&lt;asm/</span><span class="w">traps</span><span class="c">.h&gt;</span>

<span class="w">i</span><span class="c">nt</span> <span class="w">(</span><span class="c">*</span><span class="w">c6x_nmi_handler</span><span class="c">)(struct</span> <span class="w">p</span><span class="pc">t</span><span class="c">_regs</span> <span class="c">*regs</span><span class="pc">);</span>

<span class="c">void</span> <span class="w">_</span><span class="pc">_in</span><span class="c">it</span> <span class="w">trap_init</span><span class="c">(</span><span class="pc">v</span><span class="c">oid</span><span class="pc">)</span>
<span class="c">{</span>
	<span class="w">ack_exception</span><span class="c">(</span><span class="w">EXCEPT_TYPE_NXF</span><span class="c">);</span>
	<span class="w">a</span><span class="c">ck_exception(</span><span class="w">EXCEPT_TYPE_EXC</span><span class="c">);</span>
	<span class="pc">a</span><span class="c">ck_exception(</span><span class="w">EXCEPT_TYPE_IXF</span><span class="c">);</span>
	<span class="c">ack_exception(</span><span class="w">EXCEPT_TYPE_SXF</span><span class="c">);</span>
	<span class="w">enable_exception</span><span class="pc">()</span><span class="c">;</span>
<span class="c">}</span>

<span class="pc">v</span><span class="c">oid</span> <span class="w">show_regs</span><span class="c">(struct</span> <span class="w">p</span><span class="pc">t</span><span class="c">_regs</span> <span class="c">*</span><span class="w">r</span><span class="c">egs</span><span class="pc">)</span>
<span class="c">{</span>
	<span class="w">p</span><span class="pc">r_</span><span class="c">err</span><span class="w">("</span><span class="pc">\</span><span class="c">n");</span>
	<span class="w">show_regs_print_info</span><span class="c">(</span><span class="w">K</span><span class="pc">ERN_E</span><span class="c">RR);</span>
	<span class="w">pr</span><span class="pc">_e</span><span class="c">rr</span><span class="pc">("</span><span class="w">PC:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span> <span class="w">SP:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">pc</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">sp</span><span class="pc">)</span><span class="c">;</span>
	<span class="w">pr</span><span class="pc">_e</span><span class="c">rr("</span><span class="w">Status:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span> <span class="w">ORIG_A4</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">cs</span><span class="pc">r,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">orig_a4</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A0:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B0</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a0</span><span class="pc">,</span> <span class="w">re</span><span class="pc">gs</span><span class="c">-&gt;</span><span class="w">b0</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A1:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B1</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a1</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b1</span><span class="pc">)</span><span class="c">;</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A2:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B2</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a2</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b2</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A3:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B3</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a3</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b3</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A4:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B4</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a4</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b4</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A5:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B5</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a5</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b5</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A6:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B6</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a6</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b6</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A7:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B7</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a7</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b7</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A8:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B8</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a8</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b8</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A9:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B9</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a9</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b9</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A10:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B10</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a10</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b10</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A11:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B11</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a11</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b11</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A12:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B12</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a12</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b12</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A13:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B13</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a13</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b13</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A14:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B14</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a14</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">dp</span><span class="pc">)</span><span class="c">;</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A15:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B15</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a15</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">sp</span><span class="pc">)</span><span class="c">;</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A16</span><span class="pc">: </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B16</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a16</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b16</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A17:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B17</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a17</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b17</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A18:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B18</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a18</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b18</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A19:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B19</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a19</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b19</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A20:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B20</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a20</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b20</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A21:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B21</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a21</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b21</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A22:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B22</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a22</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b22</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A23:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B23</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a23</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b23</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A24:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B24</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a24</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b24</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A25:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B25</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a25</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b25</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A26:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B26</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a26</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b26</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A27:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B27</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a27</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b27</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A28:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B28</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a28</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b28</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A29:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B29</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a29</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b29</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A30:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B30</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a30</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b30</span><span class="c">);</span>
	<span class="w">p</span><span class="pc">r_e</span><span class="c">rr("</span><span class="w">A31:</span><span class="pc"> </span><span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span>  <span class="w">B31</span><span class="pc">:</span><span class="c"> %</span><span class="w">08</span><span class="pc">l</span><span class="c">x\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">a31</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">b31</span><span class="c">);</span>
<span class="c">}</span>

<span class="pc">v</span><span class="c">oid</span> <span class="w">die</span><span class="c">(</span><span class="w">c</span><span class="pc">h</span><span class="c">ar</span> <span class="c">*</span><span class="w">s</span><span class="pc">tr</span><span class="c">,</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">p</span><span class="pc">t</span><span class="c">_regs</span> <span class="c">*</span><span class="w">fp</span><span class="pc">,</span> <span class="pc">i</span><span class="c">nt</span> <span class="w">n</span><span class="pc">r)</span>
<span class="c">{</span>
	<span class="w">console_verbose(</span><span class="pc">)</span><span class="c">;</span>
	<span class="w">pr</span><span class="pc">_e</span><span class="c">rr</span><span class="pc">("%</span><span class="c">s</span><span class="w">:</span><span class="pc"> </span><span class="c">%</span><span class="w">0</span><span class="pc">8</span><span class="c">x\n",</span> <span class="w">str</span><span class="pc">,</span> <span class="w">n</span><span class="pc">r</span><span class="c">);</span>
	<span class="w">show_regs</span><span class="c">(</span><span class="w">fp</span><span class="c">);</span>

	<span class="w">pr</span><span class="pc">_e</span><span class="c">rr</span><span class="pc">("</span><span class="w">Process</span> <span class="pc">%s</span> <span class="w">(pi</span><span class="pc">d:</span><span class="c"> %</span><span class="pc">d,</span> <span class="w">stackpage</span><span class="c">=%</span><span class="w">08</span><span class="pc">l</span><span class="c">x)\n",</span>
	       <span class="w">cu</span><span class="pc">rr</span><span class="c">ent</span><span class="pc">-</span><span class="c">&gt;</span><span class="w">comm</span><span class="c">,</span> <span class="w">cu</span><span class="pc">rr</span><span class="c">ent-&gt;</span><span class="w">p</span><span class="pc">i</span><span class="c">d</span><span class="w">,</span><span class="pc"> (</span><span class="w">P</span><span class="pc">A</span><span class="c">GE_SIZE</span> <span class="w">+</span>
					     <span class="w">(u</span><span class="pc">n</span><span class="c">signed</span> <span class="c">long)</span> <span class="w">cu</span><span class="c">rrent</span><span class="w">)</span><span class="pc">)</span><span class="c">;</span>

	<span class="w">dump_stack</span><span class="pc">()</span><span class="c">;</span>
	<span class="w">w</span><span class="c">hile</span> <span class="c">(</span><span class="w">1</span><span class="c">)</span>
		<span class="w">;</span>
<span class="c">}</span>

<span class="pc">s</span><span class="c">tatic</span> <span class="pc">v</span><span class="c">oid</span> <span class="w">die_if_kernel</span><span class="c">(</span><span class="w">c</span><span class="pc">h</span><span class="c">ar</span> <span class="c">*str</span><span class="pc">,</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">p</span><span class="pc">t</span><span class="c">_regs</span> <span class="c">*</span><span class="w">fp</span><span class="pc">,</span> <span class="pc">i</span><span class="c">nt</span> <span class="w">nr</span><span class="pc">)</span>
<span class="c">{</span>
	<span class="pc">if</span> <span class="c">(</span><span class="w">user_mode</span><span class="c">(</span><span class="w">fp</span><span class="c">))</span>
		<span class="c">return</span><span class="pc">;</span>

	<span class="w">die</span><span class="c">(</span><span class="w">str</span><span class="c">,</span> <span class="w">fp</span><span class="pc">,</span> <span class="w">n</span><span class="pc">r)</span><span class="c">;</span>
<span class="c">}</span>



<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">exception_info</span> <span class="w">iexcept_table[10</span><span class="pc">] </span><span class="c">= {</span>
	<span class="w">{</span><span class="pc"> "</span><span class="w">Oops</span> <span class="w">-</span> <span class="w">instruction</span> <span class="w">fetch</span><span class="pc">"</span><span class="c">,</span> <span class="w">SIGBUS</span><span class="c">,</span> <span class="w">BUS_ADRERR</span> <span class="w">}</span><span class="pc">,</span>
	<span class="pc">{ </span><span class="c">"</span><span class="w">O</span><span class="c">ops</span> <span class="pc">-</span> <span class="pc">f</span><span class="c">etch</span> <span class="w">p</span><span class="pc">ac</span><span class="c">ket</span><span class="w">"</span><span class="c">,</span> <span class="w">S</span><span class="c">IGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="pc">{ </span><span class="c">"</span><span class="pc">O</span><span class="c">ops</span> <span class="w">-</span> <span class="w">execute</span> <span class="w">p</span><span class="pc">a</span><span class="c">cket",</span> <span class="w">SIGILL</span><span class="c">,</span> <span class="w">ILL_ILLOPC</span> <span class="pc">}</span><span class="c">,</span>
	<span class="pc">{ </span><span class="c">"</span><span class="pc">O</span><span class="c">ops</span> <span class="w">-</span> <span class="w">undefined</span> <span class="w">i</span><span class="pc">n</span><span class="c">struction</span><span class="pc">"</span><span class="c">,</span> <span class="w">S</span><span class="pc">IGI</span><span class="c">LL,</span> <span class="pc">I</span><span class="c">LL_ILLOPC</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="pc">-</span> <span class="w">res</span><span class="pc">o</span><span class="c">urce</span> <span class="w">conflict</span><span class="pc">"</span><span class="c">,</span> <span class="pc">S</span><span class="c">IGILL,</span> <span class="c">ILL_ILLOPC</span> <span class="pc">}</span><span class="c">,</span>
	<span class="pc">{ </span><span class="c">"Oops</span> <span class="pc">-</span> <span class="w">res</span><span class="pc">o</span><span class="c">urce</span> <span class="w">ac</span><span class="pc">c</span><span class="c">ess</span><span class="pc">"</span><span class="c">,</span> <span class="c">SIGILL,</span> <span class="w">ILL_PRVREG</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="pc">-</span> <span class="w">privilege</span><span class="c">",</span> <span class="pc">S</span><span class="c">IGILL,</span> <span class="w">ILL_PRVOPC</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "</span><span class="pc">O</span><span class="c">ops</span> <span class="w">-</span> <span class="w">loops</span> <span class="w">b</span><span class="pc">u</span><span class="c">ffer</span><span class="pc">"</span><span class="c">,</span> <span class="pc">S</span><span class="c">IGILL,</span> <span class="pc">ILL_I</span><span class="c">LLOPC</span> <span class="pc">}</span><span class="c">,</span>
	<span class="pc">{ </span><span class="c">"</span><span class="pc">O</span><span class="c">ops</span> <span class="w">-</span> <span class="w">software</span> <span class="w">exception</span><span class="pc">"</span><span class="c">,</span> <span class="c">SIGILL,</span> <span class="w">ILL_ILLTRP</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "</span><span class="pc">O</span><span class="c">ops</span> <span class="w">-</span> <span class="w">u</span><span class="c">nknown</span> <span class="w">e</span><span class="c">xception</span><span class="pc">"</span><span class="c">,</span> <span class="pc">S</span><span class="c">IGILL,</span> <span class="pc">ILL_ILLO</span><span class="c">PC</span> <span class="w">}</span>
<span class="w">}</span><span class="pc">;</span>


<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">exception_info</span> <span class="w">eexcept_table[1</span><span class="pc">28</span><span class="c">] = {</span>
	<span class="pc">{ </span><span class="c">"Oops</span> <span class="pc">-</span> <span class="w">external</span> <span class="w">e</span><span class="pc">x</span><span class="c">ception",</span> <span class="w">SIGBUS</span><span class="c">,</span> <span class="w">BUS_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "</span><span class="pc">O</span><span class="c">ops</span> <span class="pc">-</span> <span class="w">e</span><span class="pc">xt</span><span class="c">ernal</span> <span class="w">e</span><span class="pc">x</span><span class="c">ception",</span> <span class="w">S</span><span class="pc">IGB</span><span class="c">US,</span> <span class="c">BUS_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="pc">{ </span><span class="c">"</span><span class="pc">O</span><span class="c">ops</span> <span class="w">-</span> <span class="c">external</span> <span class="w">e</span><span class="pc">xception"</span><span class="c">,</span> <span class="pc">SIGB</span><span class="c">US,</span> <span class="c">BUS_ADRERR</span> <span class="w">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception</span><span class="pc">"</span><span class="c">,</span> <span class="c">SIGBUS,</span> <span class="c">BUS_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>

	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>

	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>

	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="c">external</span> <span class="pc">e</span><span class="c">xception",</span> <span class="c">SIGBUS,</span> <span class="pc">B</span><span class="c">US_ADRERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="w">-</span> <span class="w">CP</span><span class="c">U</span> <span class="w">m</span><span class="c">emory</span> <span class="w">protection</span> <span class="w">fault</span><span class="c">",</span> <span class="w">SIGSEGV</span><span class="pc">,</span> <span class="w">SEGV_ACCERR</span> <span class="w">}</span><span class="c">,</span>
	<span class="c">{ "</span><span class="pc">O</span><span class="c">ops</span> <span class="w">-</span> <span class="w">CP</span><span class="c">U</span> <span class="w">m</span><span class="pc">e</span><span class="c">mory</span> <span class="w">p</span><span class="c">rotection</span> <span class="w">f</span><span class="c">ault</span> <span class="w">i</span><span class="c">n</span> <span class="w">L1P</span><span class="c">",</span> <span class="w">S</span><span class="pc">IGS</span><span class="c">EGV,</span> <span class="pc">SE</span><span class="c">GV_ACCERR</span> <span class="c">},</span>
	<span class="c">{ "Oops</span> <span class="pc">-</span> <span class="w">DM</span><span class="c">A</span> <span class="w">m</span><span class="pc">e</span><span class="c">mory</span> <span class="pc">p</span><span class="c">rotection</span> <span class="pc">f</span><span class="c">ault</span> <span class="w">i</span><span class="c">n</span> <span class="w">L</span><span class="c">1P</span><span class="pc">"</span><span class="c">,</span> <span class="c">SIGSEGV</span><span class="pc">,</span> <span class="c">SEGV_ACCERR</span> <span class="w">}</span><span class="c">,</span>
	<span class="c">{ "</span><span class="w">O</span><span class="c">ops</span> <span class="pc">-</span> <span class="w">CP</span><span class="c">U</span> <span class="w">m</span><span class="c">emory</span> <span class="w">p</span><span class="c">rotection</span> <span class="w">f</span><span class="c">ault</span> <span class="w">i</span><span class="pc">n</span> <span class="w">L1D</span><span class="c">",</span> <span class="c">SIGSEGV</span><span class="pc">,</span> <span class="c">SEGV_ACCERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="pc">-</span> <span class="w">D</span><span class="pc">M</span><span class="c">A</span> <span class="w">m</span><span class="c">emory</span> <span class="pc">p</span><span class="c">rotection</span> <span class="c">fault</span> <span class="w">i</span><span class="pc">n</span> <span class="w">L</span><span class="pc">1D</span><span class="c">",</span> <span class="c">SIGSEGV</span><span class="pc">,</span> <span class="c">SEGV_ACCERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="pc">-</span> <span class="w">CP</span><span class="c">U</span> <span class="w">m</span><span class="c">emory</span> <span class="c">protection</span> <span class="c">fault</span> <span class="w">i</span><span class="pc">n</span> <span class="w">L2</span><span class="c">",</span> <span class="c">SIGSEGV</span><span class="pc">,</span> <span class="c">SEGV_ACCERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="pc">-</span> <span class="w">D</span><span class="pc">M</span><span class="c">A</span> <span class="w">m</span><span class="c">emory</span> <span class="pc">p</span><span class="c">rotection</span> <span class="c">fault</span> <span class="w">i</span><span class="pc">n</span> <span class="w">L</span><span class="pc">2</span><span class="c">",</span> <span class="c">SIGSEGV</span><span class="pc">,</span> <span class="c">SEGV_ACCERR</span> <span class="pc">}</span><span class="c">,</span>
	<span class="c">{ "Oops</span> <span class="pc">-</span> <span class="w">EMC</span> <span class="w">C</span><span class="pc">P</span><span class="c">U</span> <span class="w">me</span><span class="c">mory</span> <span class="w">p</span><span class="c">rotection</span> <span class="w">f</span><span class="c">ault</span><span class="pc">"</span><span class="c">,</span> <span class="pc">S</span><span class="c">IGSEGV</span><span class="pc">,</span> <span class="pc">SE</span><span class="c">GV_ACCERR</span> <span class="w">}</span><span class="c">,</span>
	<span class="w">{</span><span class="pc"> </span><span class="c">"Oops</span> <span class="w">-</span> <span class="w">E</span><span class="c">MC</span> <span class="w">bus</span> <span class="w">e</span><span class="c">rror",</span> <span class="w">SIGBUS</span><span class="pc">,</span> <span class="w">BUS_ADRERR</span> <span class="w">}</span>
<span class="w">}</span><span class="c">;</span>

<span class="c">static</span> <span class="w">v</span><span class="c">oid</span> <span class="w">do_trap</span><span class="c">(struct</span> <span class="w">exception_info</span> <span class="c">*</span><span class="w">except_info</span><span class="c">,</span> <span class="c">struct</span> <span class="w">p</span><span class="pc">t</span><span class="c">_regs</span> <span class="c">*</span><span class="w">r</span><span class="c">egs</span><span class="pc">)</span>
<span class="c">{</span>
	<span class="pc">u</span><span class="c">nsigned</span> <span class="c">long</span> <span class="w">a</span><span class="c">ddr</span> <span class="pc">=</span> <span class="w">instruction_pointer</span><span class="pc">(</span><span class="w">r</span><span class="pc">egs)</span><span class="c">;</span>
	<span class="w">siginfo_t</span> <span class="w">in</span><span class="pc">f</span><span class="c">o</span><span class="pc">;</span>

	<span class="pc">i</span><span class="c">f</span> <span class="pc">(except_</span><span class="c">info</span><span class="pc">-</span><span class="c">&gt;</span><span class="w">co</span><span class="pc">d</span><span class="c">e</span> <span class="pc">!</span><span class="c">=</span> <span class="w">TRAP_BRKPT</span><span class="c">)</span>
		<span class="w">pr</span><span class="pc">_</span><span class="c">err</span><span class="pc">("</span><span class="w">TRAP:</span><span class="pc"> </span><span class="c">%</span><span class="pc">s</span> <span class="w">PC[</span><span class="c">0x%</span><span class="w">l</span><span class="pc">x</span><span class="w">]</span> <span class="w">signo[</span><span class="c">%d</span><span class="w">]</span> <span class="w">cod</span><span class="pc">e</span><span class="w">[</span><span class="c">%</span><span class="pc">d]</span><span class="c">\n",</span>
		       <span class="pc">e</span><span class="c">xcept_info-&gt;</span><span class="w">kernel_str</span><span class="pc">,</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">pc</span><span class="c">,</span>
		       <span class="c">except_info-&gt;</span><span class="pc">s</span><span class="c">igno</span><span class="pc">,</span> <span class="c">except_info-&gt;</span><span class="w">c</span><span class="pc">od</span><span class="c">e</span><span class="pc">)</span><span class="c">;</span>

	<span class="w">die_if_kernel</span><span class="c">(except_info-&gt;</span><span class="pc">k</span><span class="c">ernel_str</span><span class="pc">,</span> <span class="w">r</span><span class="pc">egs,</span> <span class="w">a</span><span class="c">ddr);</span>

	<span class="w">inf</span><span class="c">o</span><span class="pc">.</span><span class="w">si_signo</span> <span class="c">=</span> <span class="c">except_info-&gt;</span><span class="w">s</span><span class="pc">ig</span><span class="c">no;</span>
	<span class="w">i</span><span class="pc">nf</span><span class="c">o</span><span class="pc">.</span><span class="w">si_errno</span> <span class="c">=</span> <span class="pc">0</span><span class="c">;</span>
	<span class="w">i</span><span class="pc">n</span><span class="c">fo</span><span class="pc">.</span><span class="w">si_code</span>  <span class="c">=</span> <span class="pc">e</span><span class="c">xcept_info</span><span class="pc">-</span><span class="c">&gt;</span><span class="w">cod</span><span class="c">e</span><span class="pc">;</span>
	<span class="pc">in</span><span class="c">fo</span><span class="pc">.</span><span class="w">si_addr</span>  <span class="pc">= (</span><span class="w">v</span><span class="c">oid</span> <span class="w">_</span><span class="pc">_u</span><span class="c">ser</span> <span class="c">*)</span><span class="w">a</span><span class="pc">dd</span><span class="c">r;</span>

	<span class="w">force_sig_info</span><span class="c">(</span><span class="w">e</span><span class="c">xcept_info</span><span class="pc">-</span><span class="c">&gt;</span><span class="w">s</span><span class="pc">ig</span><span class="c">no</span><span class="pc">, </span><span class="c">&amp;info</span><span class="pc">,</span> <span class="w">cu</span><span class="pc">rr</span><span class="c">ent);</span>
<span class="pc">}</span>


<span class="pc">s</span><span class="c">tatic</span> <span class="pc">int</span> <span class="w">process_iexcept</span><span class="c">(struct</span> <span class="w">pt</span><span class="c">_regs</span> <span class="c">*</span><span class="w">r</span><span class="pc">eg</span><span class="c">s</span><span class="pc">)</span>
<span class="c">{</span>
	<span class="w">u</span><span class="c">nsigned</span> <span class="pc">i</span><span class="c">nt</span> <span class="w">iexcept_report</span> <span class="pc">=</span> <span class="w">get_iexcept(</span><span class="pc">)</span><span class="c">;</span>
	<span class="w">u</span><span class="c">nsigned</span> <span class="c">int</span> <span class="w">iexcept_num</span><span class="c">;</span>

	<span class="w">ack_exception</span><span class="pc">(</span><span class="w">EXCEPT_TYPE_IXF</span><span class="pc">)</span><span class="c">;</span>

	<span class="w">pr_</span><span class="pc">e</span><span class="c">rr("</span><span class="w">IEXCEPT</span><span class="c">:</span> <span class="w">PC[</span><span class="pc">0x</span><span class="c">%</span><span class="w">l</span><span class="c">x</span><span class="w">]</span><span class="c">\n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">pc</span><span class="c">);</span>

	<span class="w">w</span><span class="c">hile</span> <span class="c">(</span><span class="w">i</span><span class="pc">e</span><span class="c">xcept_report</span><span class="w">)</span><span class="pc"> </span><span class="c">{</span>
		<span class="w">i</span><span class="pc">e</span><span class="c">xcept_num</span> <span class="pc">=</span> <span class="w">__ffs</span><span class="c">(</span><span class="w">i</span><span class="pc">except_r</span><span class="c">eport</span><span class="pc">)</span><span class="c">;</span>
		<span class="w">i</span><span class="pc">e</span><span class="c">xcept_report</span> <span class="w">&amp;</span><span class="c">= ~(</span><span class="pc">1</span> <span class="pc">&lt;</span><span class="c">&lt;</span> <span class="w">i</span><span class="pc">except_n</span><span class="c">um);</span>
		<span class="w">set_iexcept</span><span class="c">(iexcept_report);</span>
		<span class="pc">if</span> <span class="w">(*</span><span class="pc">(</span><span class="w">un</span><span class="pc">s</span><span class="c">igned</span> <span class="pc">i</span><span class="c">nt</span> <span class="w">*</span><span class="pc">)</span><span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">pc</span> <span class="w">=</span><span class="pc">=</span> <span class="w">BKPT_OPCODE</span><span class="pc">) </span><span class="c">{</span>
			
			<span class="pc">s</span><span class="c">truct</span> <span class="w">exception_info</span> <span class="w">bkpt_exception</span> <span class="w">=</span><span class="pc"> {</span>
				<span class="pc">"</span><span class="w">Oops</span> <span class="pc">-</span> <span class="w">undefined</span> <span class="w">instruction"</span><span class="c">,</span>
				  <span class="w">SIGTRAP</span><span class="c">,</span> <span class="w">TRAP_BRKPT</span>
			<span class="w">}</span><span class="c">;</span>
			<span class="w">do_trap(</span><span class="pc">&amp;</span><span class="w">b</span><span class="c">kpt_exception</span><span class="pc">,</span> <span class="w">re</span><span class="pc">gs)</span><span class="c">;</span>
			<span class="w">i</span><span class="pc">except_r</span><span class="c">eport</span> <span class="w">&amp;</span><span class="pc">= ~(</span><span class="w">0xF</span><span class="c">F);</span>
			<span class="w">s</span><span class="pc">e</span><span class="c">t_iexcept(</span><span class="pc">i</span><span class="c">except_report</span><span class="pc">)</span><span class="c">;</span>
			<span class="w">con</span><span class="pc">ti</span><span class="c">nue;</span>
		<span class="c">}</span>

		<span class="w">d</span><span class="c">o_trap</span><span class="w">(</span><span class="pc">&amp;</span><span class="w">iexcept_table[iexcept_num</span><span class="c">],</span> <span class="w">regs</span><span class="pc">)</span><span class="c">;</span>
	<span class="c">}</span>
	<span class="w">r</span><span class="c">eturn</span> <span class="c">0;</span>
<span class="c">}</span>


<span class="c">static</span> <span class="pc">v</span><span class="c">oid</span> <span class="w">process_eexcept</span><span class="c">(struct</span> <span class="w">pt</span><span class="c">_regs</span> <span class="c">*</span><span class="w">r</span><span class="c">egs)</span>
<span class="c">{</span>
	<span class="pc">i</span><span class="c">nt</span> <span class="w">e</span><span class="pc">vt</span><span class="c">;</span>

	<span class="w">pr_</span><span class="pc">e</span><span class="c">rr("</span><span class="w">EEXCEPT</span><span class="c">:</span> <span class="w">PC[0</span><span class="pc">x</span><span class="c">%</span><span class="pc">l</span><span class="c">x</span><span class="w">]</span><span class="pc">\</span><span class="c">n",</span> <span class="w">reg</span><span class="pc">s</span><span class="c">-&gt;</span><span class="w">pc</span><span class="c">);</span>

	<span class="w">w</span><span class="c">hile</span> <span class="pc">((</span><span class="w">ev</span><span class="pc">t</span> <span class="pc">=</span> <span class="w">soc_get_exception()) &gt;=</span> <span class="w">0)</span>
		<span class="w">do_trap</span><span class="pc">(&amp;</span><span class="w">eexcept_table</span><span class="pc">[</span><span class="w">ev</span><span class="pc">t</span><span class="w">]</span><span class="pc">,</span> <span class="w">re</span><span class="pc">gs)</span><span class="c">;</span>

	<span class="w">ack_exception</span><span class="pc">(</span><span class="w">EXCEPT_TYPE_EXC</span><span class="pc">)</span><span class="c">;</span>
<span class="c">}</span>


<span class="w">as</span><span class="pc">m</span><span class="c">linkage</span> <span class="pc">i</span><span class="c">nt</span> <span class="w">process_exception</span><span class="c">(struct</span> <span class="w">p</span><span class="pc">t</span><span class="c">_regs</span> <span class="c">*</span><span class="w">r</span><span class="pc">eg</span><span class="c">s</span><span class="pc">)</span>
<span class="c">{</span>
	<span class="pc">u</span><span class="c">nsigned</span> <span class="pc">i</span><span class="c">nt</span> <span class="w">t</span><span class="pc">y</span><span class="c">pe;</span>
	<span class="c">unsigned</span> <span class="pc">i</span><span class="c">nt</span> <span class="w">type_num</span><span class="c">;</span>
	<span class="c">unsigned</span> <span class="c">int</span> <span class="w">ie_num</span> <span class="pc">=</span> <span class="w">9</span><span class="c">;</span> 

	<span class="w">w</span><span class="c">hile</span> <span class="pc">((</span><span class="w">t</span><span class="pc">ype</span> <span class="c">=</span> <span class="w">get_except_type()) !=</span> <span class="w">0) </span><span class="pc">{</span>
		<span class="w">t</span><span class="c">ype_num</span> <span class="c">=</span> <span class="w">fls</span><span class="c">(</span><span class="w">ty</span><span class="pc">pe</span><span class="w">) </span><span class="pc">-</span> <span class="c">1;</span>

		<span class="w">s</span><span class="c">witch</span> <span class="c">(type_num) {</span>
		<span class="c">case</span> <span class="w">EXCEPT_TYPE_NXF</span><span class="c">:</span>
			<span class="w">ack_exception</span><span class="pc">(</span><span class="w">E</span><span class="c">XCEPT_TYPE_NXF</span><span class="pc">)</span><span class="c">;</span>
			<span class="pc">i</span><span class="c">f</span> <span class="c">(</span><span class="w">c6x_nmi_handler</span><span class="pc">)</span>
				<span class="w">(</span><span class="pc">c</span><span class="c">6x_nmi_handler</span><span class="w">)(reg</span><span class="pc">s)</span><span class="c">;</span>
			<span class="w">e</span><span class="c">lse</span>
				<span class="w">pr_alert(</span><span class="pc">"</span><span class="w">NMI</span> <span class="w">int</span><span class="pc">e</span><span class="c">rrupt</span><span class="w">!</span><span class="c">\n");</span>
			<span class="pc">b</span><span class="c">reak;</span>

		<span class="pc">c</span><span class="c">ase</span> <span class="w">EXCEPT_TYPE_IXF</span><span class="c">:</span>
			<span class="pc">i</span><span class="c">f</span> <span class="c">(</span><span class="w">process_iexcept</span><span class="c">(</span><span class="w">reg</span><span class="pc">s</span><span class="w">)</span><span class="pc">)</span>
				<span class="c">return</span> <span class="pc">1</span><span class="c">;</span>
			<span class="pc">b</span><span class="c">reak;</span>

		<span class="c">case</span> <span class="w">EXCEPT_TYPE_EXC</span><span class="c">:</span>
			<span class="w">process_eexcept</span><span class="c">(</span><span class="w">reg</span><span class="pc">s)</span><span class="c">;</span>
			<span class="pc">b</span><span class="c">reak;</span>

		<span class="c">case</span> <span class="w">EXCEPT_TYPE_SXF</span><span class="c">:</span>
			<span class="w">ie_num</span> <span class="pc">=</span> <span class="w">8</span><span class="c">;</span>
		<span class="w">d</span><span class="c">efault:</span>
			<span class="w">ack_exception</span><span class="c">(</span><span class="w">type_num</span><span class="c">);</span>
			<span class="w">do_trap(</span><span class="pc">&amp;</span><span class="w">iexcept_table</span><span class="pc">[i</span><span class="c">e_num</span><span class="pc">],</span> <span class="w">re</span><span class="pc">gs)</span><span class="c">;</span>
			<span class="pc">b</span><span class="c">reak;</span>
		<span class="pc">}</span>
	<span class="c">}</span>
	<span class="pc">r</span><span class="c">eturn</span> <span class="c">0;</span>
<span class="c">}</span>

<span class="c">static</span> <span class="c">int</span> <span class="w">kstack_depth_to_print</span> <span class="pc">=</span> <span class="w">4</span><span class="pc">8;</span>

<span class="c">static</span> <span class="pc">v</span><span class="c">oid</span> <span class="w">show_trace</span><span class="c">(</span><span class="pc">u</span><span class="c">nsigned</span> <span class="pc">l</span><span class="c">ong</span> <span class="pc">*</span><span class="w">stack</span><span class="pc">,</span> <span class="c">unsigned</span> <span class="pc">l</span><span class="c">ong</span> <span class="pc">*</span><span class="w">endstack</span><span class="c">)</span>
<span class="c">{</span>
	<span class="pc">u</span><span class="c">nsigned</span> <span class="c">long</span> <span class="w">a</span><span class="c">ddr;</span>
	<span class="pc">i</span><span class="c">nt</span> <span class="c">i;</span>

	<span class="w">p</span><span class="c">r_debug</span><span class="pc">("</span><span class="w">Call</span> <span class="w">tra</span><span class="pc">c</span><span class="c">e</span><span class="w">:");</span>
	<span class="w">i</span> <span class="w">=</span> <span class="pc">0</span><span class="c">;</span>
	<span class="w">w</span><span class="c">hile</span> <span class="c">(</span><span class="w">s</span><span class="pc">t</span><span class="c">ack</span> <span class="w">+</span> <span class="pc">1</span> <span class="w">&lt;</span><span class="pc">=</span> <span class="pc">e</span><span class="c">ndstack</span><span class="pc">) </span><span class="c">{</span>
		<span class="w">a</span><span class="pc">d</span><span class="c">dr</span> <span class="w">=</span><span class="pc"> *</span><span class="c">stack</span><span class="w">+</span><span class="pc">+</span><span class="c">;</span>
		
		<span class="pc">i</span><span class="c">f</span> <span class="c">(</span><span class="w">__kernel_text_address</span><span class="pc">(</span><span class="w">a</span><span class="c">ddr</span><span class="w">))</span><span class="pc"> </span><span class="c">{</span>
<span class="w">#i</span><span class="pc">fn</span><span class="c">def</span> <span class="w">CONFIG_KALLSYMS</span>
			<span class="pc">i</span><span class="c">f</span> <span class="c">(</span><span class="w">i</span> <span class="w">%</span> <span class="w">5</span> <span class="pc">=</span><span class="c">=</span> <span class="c">0)</span>
				<span class="w">pr_</span><span class="pc">d</span><span class="c">ebug</span><span class="w">(</span><span class="pc">"\</span><span class="c">n</span>	    <span class="c">");</span>
<span class="w">#</span><span class="c">endif</span>
			<span class="w">p</span><span class="pc">r_</span><span class="c">debug</span><span class="w">(" [&lt;%08</span><span class="pc">l</span><span class="c">x</span><span class="w">&gt;]",</span> <span class="w">ad</span><span class="pc">dr</span><span class="w">)</span><span class="pc">;</span>
			<span class="w">print_symbol(" %s</span><span class="c">\n</span><span class="pc">",</span> <span class="w">a</span><span class="pc">d</span><span class="c">dr</span><span class="pc">)</span><span class="c">;</span>
			<span class="w">i</span><span class="pc">+</span><span class="c">+;</span>
		<span class="c">}</span>
	<span class="c">}</span>
	<span class="w">pr</span><span class="pc">_d</span><span class="c">ebug</span><span class="w">("</span><span class="pc">\</span><span class="c">n");</span>
<span class="c">}</span>

<span class="pc">v</span><span class="c">oid</span> <span class="w">show_stack</span><span class="c">(struct</span> <span class="w">t</span><span class="c">ask_struct</span> <span class="c">*</span><span class="w">t</span><span class="c">ask</span><span class="pc">,</span> <span class="pc">u</span><span class="c">nsigned</span> <span class="c">long</span> <span class="w">*stack</span><span class="pc">)</span>
<span class="c">{</span>
	<span class="pc">u</span><span class="c">nsigned</span> <span class="c">long</span> <span class="pc">*</span><span class="w">p,</span><span class="pc"> </span><span class="c">*</span><span class="w">endstack</span><span class="c">;</span>
	<span class="pc">i</span><span class="c">nt</span> <span class="c">i;</span>

	<span class="pc">if</span> <span class="c">(!</span><span class="pc">s</span><span class="c">tack</span><span class="pc">) </span><span class="c">{</span>
		<span class="pc">i</span><span class="c">f</span> <span class="c">(</span><span class="w">ta</span><span class="pc">s</span><span class="c">k</span> <span class="w">&amp;</span><span class="pc">&amp;</span> <span class="pc">t</span><span class="c">ask</span> <span class="pc">!</span><span class="c">=</span> <span class="w">cu</span><span class="pc">rre</span><span class="c">nt</span><span class="pc">)</span>
			
			<span class="pc">s</span><span class="c">tack</span> <span class="w">=</span><span class="pc"> </span><span class="c">(</span><span class="w">u</span><span class="c">nsigned</span> <span class="c">long</span> <span class="w">*</span><span class="pc">)</span><span class="w">thread_saved_ksp</span><span class="c">(</span><span class="w">t</span><span class="pc">a</span><span class="c">sk);</span>
		<span class="pc">e</span><span class="c">lse</span>
			<span class="w">s</span><span class="pc">tac</span><span class="c">k</span> <span class="w">=</span><span class="pc"> </span><span class="c">(unsigned</span> <span class="c">long</span> <span class="w">*</span><span class="pc">)&amp;</span><span class="c">stack</span><span class="pc">;</span>
	<span class="c">}</span>
	<span class="w">e</span><span class="pc">n</span><span class="c">dstack</span> <span class="w">=</span><span class="pc"> </span><span class="c">(</span><span class="pc">u</span><span class="c">nsigned</span> <span class="c">long</span> <span class="w">*)(((u</span><span class="c">nsigned</span> <span class="c">long</span><span class="w">)s</span><span class="c">tack</span> <span class="w">+</span> <span class="w">THREAD_SIZE</span> <span class="w">-</span> <span class="pc">1)</span>
				     <span class="w">&amp; -T</span><span class="c">HREAD_SIZE</span><span class="w">)</span><span class="pc">;</span>

	<span class="w">pr</span><span class="pc">_d</span><span class="c">ebug</span><span class="pc">("</span><span class="w">Stack</span> <span class="w">f</span><span class="pc">r</span><span class="c">om</span> <span class="c">%</span><span class="w">08</span><span class="pc">l</span><span class="c">x</span><span class="w">:", (u</span><span class="pc">n</span><span class="c">signed</span> <span class="c">long</span><span class="w">)s</span><span class="c">tack</span><span class="w">)</span><span class="c">;</span>
	<span class="w">f</span><span class="c">or</span> <span class="c">(i</span> <span class="c">=</span> <span class="c">0</span><span class="pc">,</span> <span class="pc">p</span> <span class="w">=</span> <span class="c">stack</span><span class="pc">;</span> <span class="c">i</span> <span class="pc">&lt;</span> <span class="w">kstack_depth_to_print</span><span class="c">;</span> <span class="c">i</span><span class="pc">++) </span><span class="c">{</span>
		<span class="c">if</span> <span class="c">(</span><span class="w">p</span> <span class="w">+</span> <span class="pc">1</span> <span class="w">&gt;</span> <span class="w">endstack</span><span class="c">)</span>
			<span class="w">b</span><span class="c">reak;</span>
		<span class="c">if</span> <span class="c">(</span><span class="w">i</span> <span class="w">%</span> <span class="w">8</span> <span class="w">=</span><span class="c">=</span> <span class="c">0)</span>
			<span class="w">pr_cont("</span><span class="pc">\</span><span class="c">n</span>	    <span class="pc">")</span><span class="c">;</span>
		<span class="w">p</span><span class="pc">r_</span><span class="c">cont</span><span class="w">(" %08</span><span class="pc">l</span><span class="c">x</span><span class="w">", *p++</span><span class="pc">)</span><span class="c">;</span>
	<span class="c">}</span>
	<span class="w">p</span><span class="pc">r</span><span class="c">_cont</span><span class="w">("</span><span class="pc">\</span><span class="c">n");</span>
	<span class="w">show_trace</span><span class="c">(</span><span class="w">stack</span><span class="c">,</span> <span class="w">e</span><span class="c">ndstack);</span>
<span class="c">}</span>

<span class="w">i</span><span class="pc">n</span><span class="c">t</span> <span class="w">is_valid_bugaddr</span><span class="c">(</span><span class="w">u</span><span class="c">nsigned</span> <span class="c">long</span> <span class="w">a</span><span class="pc">ddr)</span>
<span class="c">{</span>
	<span class="pc">r</span><span class="c">eturn</span> <span class="w">__kernel_text_address</span><span class="pc">(</span><span class="w">a</span><span class="pc">dd</span><span class="c">r</span><span class="pc">)</span><span class="c">;</span>
<span class="c">}</span>

</pre>
</body>
</html>

